<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sports Legend RPG</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Segoe UI', sans-serif;
  background: #0a0a1a;
  color: #fff;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}
body::before {
  content:'';
  position:fixed;
  inset:0;
  background:
    radial-gradient(ellipse at 20% 50%, #1a0a3a 0%, transparent 60%),
    radial-gradient(ellipse at 80% 20%, #0a2a1a 0%, transparent 60%),
    radial-gradient(ellipse at 60% 80%, #1a1a0a 0%, transparent 60%);
  z-index:0;
}
.wrap { position:relative; z-index:1; width:95%; max-width:760px; }
.screen { display:none; flex-direction:column; align-items:center; gap:18px; }
.screen.active { display:flex; }
.logo { font-size:2.6rem; font-weight:900; text-align:center;
  background:linear-gradient(135deg,#f7c948,#ff6b35,#e63946);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.sub { color:#aaa; font-size:.95rem; text-align:center; }
.card {
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:20px; padding:24px; width:100%;
  backdrop-filter:blur(10px);
}
.card-title { font-size:1rem; font-weight:700; color:#f7c948; margin-bottom:14px; text-align:center; letter-spacing:1px; text-transform:uppercase; }
.btn { padding:14px 36px; border:none; border-radius:50px; font-size:1rem; font-weight:800; cursor:pointer; transition:all .2s; }
.btn-gold { background:linear-gradient(135deg,#f7c948,#ff6b35); color:#000; }
.btn-gold:hover { transform:scale(1.05); box-shadow:0 6px 24px rgba(247,201,72,.4); }
.btn-outline { background:transparent; border:2px solid rgba(255,255,255,.25); color:#fff; }
.btn-outline:hover { border-color:#f7c948; background:rgba(247,201,72,.1); }
.name-input {
  width:100%; padding:14px 18px; border-radius:14px;
  background:rgba(255,255,255,.08); border:2px solid rgba(255,255,255,.2);
  color:#fff; font-size:1.1rem; font-weight:700; text-align:center;
  outline:none; transition:border .2s;
}
.name-input:focus { border-color:#f7c948; }
.name-input::placeholder { color:#555; }
.sport-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.sport-card {
  padding:20px 10px; border-radius:16px; border:2px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.05); cursor:pointer; text-align:center; transition:all .2s;
}
.sport-card:hover,.sport-card.sel { border-color:#f7c948; background:rgba(247,201,72,.12); transform:scale(1.03); }
.sport-card .icon { font-size:2.2rem; }
.sport-card .sname { font-size:.8rem; font-weight:700; margin-top:6px; color:#ddd; }
.sport-card .sdesc { font-size:.7rem; color:#888; margin-top:3px; line-height:1.3; }
.class-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.class-card {
  padding:18px 10px; border-radius:16px; border:2px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.05); cursor:pointer; text-align:center; transition:all .2s;
}
.class-card:hover,.class-card.sel { border-color:#a78bfa; background:rgba(167,139,250,.12); transform:scale(1.03); }
.class-card .icon { font-size:1.8rem; }
.class-card .cname { font-size:.85rem; font-weight:700; margin-top:6px; }
.class-card .cdesc { font-size:.68rem; color:#888; margin-top:3px; line-height:1.3; }
.hero-panel { display:flex; gap:20px; align-items:flex-start; width:100%; }
.avatar-box {
  min-width:110px; text-align:center;
  background:rgba(255,255,255,.06); border:2px solid rgba(255,255,255,.15);
  border-radius:18px; padding:16px 10px;
}
.avatar-emoji { font-size:3.4rem; }
.avatar-name  { font-size:.85rem; font-weight:800; color:#f7c948; margin-top:6px; }
.avatar-level { font-size:.7rem; color:#888; margin-top:2px; }
.avatar-class { font-size:.7rem; color:#a78bfa; margin-top:2px; }
.stats-panel  { flex:1; display:flex; flex-direction:column; gap:10px; }
.stat-row { display:flex; align-items:center; gap:10px; }
.stat-label { font-size:.75rem; color:#aaa; width:80px; text-transform:uppercase; letter-spacing:.5px; }
.stat-bar-wrap { flex:1; height:10px; background:rgba(255,255,255,.1); border-radius:5px; overflow:hidden; }
.stat-bar { height:100%; border-radius:5px; transition:width .6s ease; }
.stat-val { font-size:.8rem; font-weight:700; color:#fff; width:28px; text-align:right; }
.bar-speed   { background:linear-gradient(90deg,#2ecc71,#1abc9c); }
.bar-power   { background:linear-gradient(90deg,#e63946,#ff6b35); }
.bar-iq      { background:linear-gradient(90deg,#a78bfa,#7c3aed); }
.bar-stamina { background:linear-gradient(90deg,#f7c948,#f59e0b); }
.bar-clutch  { background:linear-gradient(90deg,#ec4899,#be185d); }
.xp-section  { width:100%; }
.xp-label    { display:flex; justify-content:space-between; font-size:.75rem; color:#aaa; margin-bottom:6px; }
.xp-bar-wrap { width:100%; height:14px; background:rgba(255,255,255,.1); border-radius:7px; overflow:hidden; }
.xp-bar      { height:100%; border-radius:7px; background:linear-gradient(90deg,#f7c948,#ff6b35); transition:width .6s ease; }
.action-btns { display:grid; grid-template-columns:1fr 1fr; gap:12px; width:100%; }
.action-btn  {
  padding:18px; border-radius:16px; border:2px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.06); color:#fff; cursor:pointer; transition:all .2s; text-align:center;
}
.action-btn:hover { transform:translateY(-2px); }
.action-btn .ab-icon  { font-size:1.8rem; }
.action-btn .ab-title { font-size:.9rem; font-weight:800; margin-top:6px; }
.action-btn .ab-desc  { font-size:.72rem; color:#888; margin-top:3px; }
.action-btn.ab-trivia:hover { border-color:#f7c948; background:rgba(247,201,72,.1); }
.action-btn.ab-battle:hover { border-color:#e63946; background:rgba(230,57,70,.1); }
.action-btn.ab-shop:hover   { border-color:#a78bfa; background:rgba(167,139,250,.1); }
.badge-row { display:flex; gap:8px; flex-wrap:wrap; }
.badge { padding:4px 12px; border-radius:20px; font-size:.72rem; font-weight:700; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.2); color:#ccc; }
.badge.earned { background:rgba(247,201,72,.2); border-color:#f7c948; color:#f7c948; }
.hud { display:flex; gap:10px; width:100%; }
.hud-box { flex:1; background:rgba(255,255,255,.08); border-radius:14px; padding:10px; text-align:center; }
.hud-lbl { font-size:.65rem; color:#888; text-transform:uppercase; letter-spacing:1px; }
.hud-val { font-size:1.3rem; font-weight:800; color:#f7c948; }
.timer-wrap { width:100%; height:8px; background:rgba(255,255,255,.1); border-radius:4px; overflow:hidden; }
.timer-bar  { height:100%; border-radius:4px; transition:width 1s linear, background .5s; }
.sport-badge { display:inline-block; padding:4px 14px; border-radius:20px; font-size:.78rem; font-weight:700; letter-spacing:1px; margin-bottom:10px; }
.badge-basketball { background:rgba(255,107,53,.3); color:#ff6b35; border:1px solid #ff6b35; }
.badge-football   { background:rgba(200,135,58,.3); color:#c8873a; border:1px solid #c8873a; }
.badge-soccer     { background:rgba(46,204,113,.3); color:#2ecc71; border:1px solid #2ecc71; }
.q-text    { font-size:1.2rem; font-weight:700; line-height:1.4; }
.diff-badge  { float:right; font-size:.7rem; padding:3px 10px; border-radius:10px; font-weight:700; }
.diff-easy   { background:rgba(46,204,113,.3); color:#2ecc71; }
.diff-medium { background:rgba(247,201,72,.3);  color:#f7c948; }
.diff-hard   { background:rgba(230,57,70,.3);   color:#e63946; }
.answers { display:grid; grid-template-columns:1fr 1fr; gap:12px; width:100%; }
.ans-btn {
  padding:16px 14px; border-radius:14px; border:2px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.06); color:#fff; font-size:.95rem; font-weight:600;
  cursor:pointer; transition:all .2s; text-align:left; line-height:1.3;
}
.ans-btn:hover:not(:disabled) { border-color:#f7c948; background:rgba(247,201,72,.1); transform:translateY(-2px); }
.ans-btn.correct { border-color:#2ecc71!important; background:rgba(46,204,113,.25)!important; }
.ans-btn.wrong   { border-color:#e63946!important; background:rgba(230,57,70,.25)!important; }
.ans-btn:disabled { cursor:default; }
.feedback { text-align:center; font-size:1rem; font-weight:700; min-height:28px; }
.feedback.correct { color:#2ecc71; }
.feedback.wrong   { color:#e63946; }
.reward-popup {
  display:none; background:rgba(247,201,72,.15); border:2px solid #f7c948;
  border-radius:16px; padding:14px 20px; text-align:center; width:100%;
  animation:pop .3s ease;
}
@keyframes pop { 0%{transform:scale(.7);opacity:0} 80%{transform:scale(1.05)} 100%{transform:scale(1);opacity:1} }
.upgrade-grid { display:flex; flex-direction:column; gap:12px; width:100%; }
.upgrade-row {
  display:flex; align-items:center; gap:14px;
  background:rgba(255,255,255,.05); border-radius:14px; padding:14px;
  border:1px solid rgba(255,255,255,.1);
}
.up-info { flex:1; }
.up-name { font-size:.9rem; font-weight:700; }
.up-desc { font-size:.72rem; color:#888; margin-top:2px; }
.up-bar-wrap { width:100%; height:8px; background:rgba(255,255,255,.1); border-radius:4px; overflow:hidden; margin-top:6px; }
.up-bar { height:100%; border-radius:4px; transition:width .4s; }
.up-val { font-size:1.1rem; font-weight:800; color:#f7c948; width:28px; text-align:center; }
.up-btn {
  padding:8px 16px; border-radius:30px; border:none;
  background:linear-gradient(135deg,#f7c948,#ff6b35); color:#000;
  font-weight:800; cursor:pointer; font-size:.85rem; transition:all .2s; white-space:nowrap;
}
.up-btn:hover { transform:scale(1.05); }
.up-btn:disabled { background:rgba(255,255,255,.15); color:#666; cursor:not-allowed; transform:none; }
.sp-display {
  text-align:center; padding:14px; background:rgba(167,139,250,.1);
  border:2px solid rgba(167,139,250,.4); border-radius:14px; width:100%;
}
.sp-num { font-size:2rem; font-weight:900; color:#a78bfa; }
.sp-lbl { font-size:.8rem; color:#aaa; margin-top:2px; }
.levelup-big   { font-size:5rem; text-align:center; animation:bounce 1s infinite alternate; }
@keyframes bounce { from{transform:translateY(0)} to{transform:translateY(-14px)} }
.levelup-title { font-size:2rem; font-weight:900; text-align:center;
  background:linear-gradient(135deg,#f7c948,#ff6b35); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.perk-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; width:100%; }
.perk-card {
  padding:16px; border-radius:14px; border:2px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.06); cursor:pointer; transition:all .2s; text-align:center;
}
.perk-card:hover { border-color:#f7c948; background:rgba(247,201,72,.1); transform:scale(1.03); }
.perk-icon { font-size:1.8rem; }
.perk-name { font-size:.9rem; font-weight:800; margin-top:6px; color:#f7c948; }
.perk-desc { font-size:.72rem; color:#aaa; margin-top:4px; line-height:1.3; }
.battle-arena  { width:100%; display:flex; flex-direction:column; gap:16px; }
.combatants    { display:flex; gap:16px; align-items:center; }
.fighter {
  flex:1; background:rgba(255,255,255,.06); border-radius:16px; padding:16px; text-align:center;
  border:2px solid rgba(255,255,255,.15);
}
.fighter.player { border-color:rgba(247,201,72,.4); }
.fighter.enemy  { border-color:rgba(230,57,70,.4); }
.f-avatar  { font-size:2.8rem; }
.f-name    { font-size:.85rem; font-weight:800; margin-top:6px; }
.f-hp-wrap { width:100%; height:10px; background:rgba(255,255,255,.1); border-radius:5px; overflow:hidden; margin-top:8px; }
.f-hp-bar  { height:100%; border-radius:5px; transition:width .5s; }
.f-hp-bar.player { background:linear-gradient(90deg,#2ecc71,#1abc9c); }
.f-hp-bar.enemy  { background:linear-gradient(90deg,#e63946,#ff6b35); }
.f-hp-text { font-size:.72rem; color:#aaa; margin-top:4px; }
.vs-badge  { font-size:1.4rem; font-weight:900; color:#f7c948; }
.battle-log {
  background:rgba(0,0,0,.3); border-radius:14px; padding:14px;
  height:90px; overflow-y:auto; font-size:.8rem; color:#ccc; line-height:1.8;
}
.battle-actions { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.battle-action {
  padding:14px; border-radius:14px; border:2px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.06); color:#fff; cursor:pointer;
  font-size:.85rem; font-weight:700; transition:all .2s; text-align:center;
}
.battle-action:hover { border-color:#f7c948; background:rgba(247,201,72,.1); }
.btv-card {
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
  border-radius:20px; padding:20px; width:100%;
}
.btv-label  { color:#f7c948; font-weight:700; font-size:.85rem; margin-bottom:12px; }
.btv-badge  { display:inline-block; padding:4px 14px; border-radius:20px; font-size:.78rem; font-weight:700; letter-spacing:1px; margin-bottom:10px; }
.btv-qtext  { font-size:1.1rem; font-weight:700; line-height:1.4; margin-bottom:14px; }
.btv-answers { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:12px; }
.btv-ans {
  padding:14px 12px; border-radius:14px; border:2px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.06); color:#fff; font-size:.9rem; font-weight:600;
  cursor:pointer; transition:all .2s; text-align:left; line-height:1.3;
}
.btv-ans:hover:not(:disabled) { border-color:#f7c948; background:rgba(247,201,72,.1); }
.btv-ans.correct { border-color:#2ecc71!important; background:rgba(46,204,113,.25)!important; }
.btv-ans.wrong   { border-color:#e63946!important; background:rgba(230,57,70,.25)!important; }
.btv-ans:disabled { cursor:default; }
.btv-feedback { text-align:center; font-size:.95rem; font-weight:700; min-height:24px; }
.btv-feedback.correct { color:#2ecc71; }
.btv-feedback.wrong   { color:#e63946; }
.btv-timer-wrap { width:100%; height:7px; background:rgba(255,255,255,.1); border-radius:4px; overflow:hidden; margin-top:10px; }
.btv-timer-bar  { height:100%; border-radius:4px; transition:width 1s linear, background .5s; background:#2ecc71; }
.progress-dots { display:flex; gap:6px; justify-content:center; flex-wrap:wrap; }
.dot { width:13px; height:13px; border-radius:50%; background:rgba(255,255,255,.15); transition:background .3s; }
.dot.correct { background:#2ecc71; }
.dot.wrong   { background:#e63946; }
@media(max-width:500px){
  .answers,.btv-answers,.perk-grid,.battle-actions,.action-btns { grid-template-columns:1fr; }
  .logo { font-size:2rem; }
  .hero-panel { flex-direction:column; }
}
</style>
</head>
<body>
<div class="wrap">

<!-- INTRO -->
<div class="screen active" id="introScreen">
  <div class="logo">üèÜ Sports Legend RPG</div>
  <div class="sub">Build your athlete. Answer trivia. Become a legend.</div>
  <div class="card" style="text-align:center;padding:32px">
    <div style="font-size:4rem">üåü</div>
    <div style="margin-top:16px;font-size:1rem;color:#ccc;line-height:1.7">
      Create your athlete, choose your sport, and prove your sports knowledge.<br>
      Answer trivia to earn XP, unlock abilities, and battle rival legends!
    </div>
  </div>
  <button class="btn btn-gold" onclick="show('createScreen1')">‚ö° Start Your Journey</button>
</div>

<!-- NAME + SPORT -->
<div class="screen" id="createScreen1">
  <div class="logo" style="font-size:1.8rem">Create Your Athlete</div>
  <div class="card">
    <div class="card-title">Your Name</div>
    <input class="name-input" id="nameInput" placeholder="Enter your athlete name..." maxlength="18">
  </div>
  <div class="card">
    <div class="card-title">Choose Your Sport</div>
    <div class="sport-grid">
      <div class="sport-card" data-sport="basketball" onclick="selectSport(this)">
        <div class="icon">üèÄ</div><div class="sname">Basketball</div><div class="sdesc">Speed +3<br>Clutch +2</div>
      </div>
      <div class="sport-card" data-sport="football" onclick="selectSport(this)">
        <div class="icon">üèà</div><div class="sname">Football</div><div class="sdesc">Power +3<br>Stamina +2</div>
      </div>
      <div class="sport-card" data-sport="soccer" onclick="selectSport(this)">
        <div class="icon">‚öΩ</div><div class="sname">Soccer</div><div class="sdesc">Speed +2<br>Stamina +3</div>
      </div>
    </div>
  </div>
  <button class="btn btn-gold" onclick="goToClass()">Next ‚Üí</button>
</div>

<!-- CLASS -->
<div class="screen" id="createScreen2">
  <div class="logo" style="font-size:1.8rem">Choose Your Class</div>
  <div class="card">
    <div class="card-title">Athlete Archetype</div>
    <div class="class-grid">
      <div class="class-card" data-class="scorer" onclick="selectClass(this)">
        <div class="icon">üéØ</div><div class="cname">Scorer</div><div class="cdesc">High Power & Clutch. Born to put points on the board.</div>
      </div>
      <div class="class-card" data-class="speedster" onclick="selectClass(this)">
        <div class="icon">‚ö°</div><div class="cname">Speedster</div><div class="cdesc">Max Speed & Stamina. Nobody can keep up with you.</div>
      </div>
      <div class="class-card" data-class="playmaker" onclick="selectClass(this)">
        <div class="icon">üß†</div><div class="cname">Playmaker</div><div class="cdesc">High IQ & Clutch. You see the game before it happens.</div>
      </div>
    </div>
  </div>
  <div class="card" id="classPrev" style="display:none">
    <div class="card-title">Starting Stats Preview</div>
    <div id="classPreviewStats"></div>
  </div>
  <div style="display:flex;gap:12px">
    <button class="btn btn-outline" onclick="show('createScreen1')">‚Üê Back</button>
    <button class="btn btn-gold" onclick="finalizeChar()">Create Athlete! üöÄ</button>
  </div>
</div>

<!-- HUB -->
<div class="screen" id="hubScreen">
  <div class="hero-panel">
    <div class="avatar-box">
      <div class="avatar-emoji" id="hubAvatar">üèÄ</div>
      <div class="avatar-name"  id="hubName">‚Äî</div>
      <div class="avatar-level" id="hubLevel">Level 1</div>
      <div class="avatar-class" id="hubClass">Scorer</div>
    </div>
    <div class="stats-panel" id="statsPanel"></div>
  </div>
  <div class="xp-section card">
    <div class="xp-label"><span>‚≠ê XP Progress</span><span id="xpLabel">0 / 100 XP</span></div>
    <div class="xp-bar-wrap"><div class="xp-bar" id="xpBar" style="width:0%"></div></div>
    <div style="margin-top:8px;font-size:.75rem;color:#888;text-align:center">Stat Points: <span id="spCount" style="color:#a78bfa;font-weight:800">0</span></div>
  </div>
  <div class="action-btns">
    <div class="action-btn ab-trivia" onclick="startTrivia('easy')">
      <div class="ab-icon">üéØ</div><div class="ab-title">Easy Trivia</div><div class="ab-desc">+10‚Äì20 XP per question</div>
    </div>
    <div class="action-btn ab-trivia" onclick="startTrivia('medium')">
      <div class="ab-icon">üî•</div><div class="ab-title">Medium Trivia</div><div class="ab-desc">+20‚Äì35 XP per question</div>
    </div>
    <div class="action-btn ab-trivia" onclick="startTrivia('hard')">
      <div class="ab-icon">üíÄ</div><div class="ab-title">Hard Trivia</div><div class="ab-desc">+35‚Äì60 XP per question</div>
    </div>
    <div class="action-btn ab-battle" onclick="startBattle()">
      <div class="ab-icon">‚öîÔ∏è</div><div class="ab-title">Battle Rival</div><div class="ab-desc">Fight rival athletes!</div>
    </div>
    <div class="action-btn ab-shop" onclick="show('upgradeScreen')" style="grid-column:1/-1">
      <div class="ab-icon">üìà</div><div class="ab-title">Upgrade Stats</div><div class="ab-desc">Spend Stat Points to power up your athlete</div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">üèÖ Achievements</div>
    <div class="badge-row" id="badgeRow">
      <div class="badge" id="badge-first">First Answer</div>
      <div class="badge" id="badge-streak3">3 Streak</div>
      <div class="badge" id="badge-streak5">5 Streak</div>
      <div class="badge" id="badge-level5">Level 5</div>
      <div class="badge" id="badge-level10">Level 10</div>
      <div class="badge" id="badge-battle">Battle Win</div>
      <div class="badge" id="badge-perfect">Perfect Round</div>
    </div>
  </div>
</div>

<!-- TRIVIA -->
<div class="screen" id="triviaScreen">
  <div class="hud">
    <div class="hud-box"><div class="hud-lbl">XP Earned</div><div class="hud-val" id="t-xp">0</div></div>
    <div class="hud-box"><div class="hud-lbl">Streak üî•</div><div class="hud-val" id="t-streak">0</div></div>
    <div class="hud-box"><div class="hud-lbl">Question</div><div class="hud-val" id="t-qnum">1/5</div></div>
  </div>
  <div class="timer-wrap"><div class="timer-bar" id="timerBar"></div></div>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
      <div id="sportBadge" class="sport-badge"></div>
      <div id="diffBadge"  class="diff-badge"></div>
    </div>
    <div class="q-text" id="qText"></div>
  </div>
  <div class="answers"      id="answersGrid"></div>
  <div class="feedback"     id="feedback"></div>
  <div class="reward-popup" id="rewardPopup"></div>
  <div class="progress-dots" id="progressDots"></div>
</div>

<!-- RESULTS -->
<div class="screen" id="resultsScreen">
  <div class="logo" style="font-size:1.8rem">Round Complete!</div>
  <div class="card" style="text-align:center">
    <div style="font-size:3.5rem" id="resultEmoji">‚≠ê</div>
    <div style="font-size:2.2rem;font-weight:900;color:#f7c948;margin-top:8px" id="resultXP">+0 XP</div>
    <div style="color:#aaa;font-size:.9rem;margin-top:4px" id="resultMsg"></div>
  </div>
  <div class="card" id="statGainCard" style="display:none">
    <div class="card-title">üìà Stat Boosts Earned</div>
    <div id="statGainList"></div>
  </div>
  <div style="display:flex;gap:12px">
    <button class="btn btn-outline" onclick="show('hubScreen');renderHub()">üè† Hub</button>
    <button class="btn btn-gold"    id="playAgainBtn">‚ñ∂ Play Again</button>
  </div>
</div>

<!-- UPGRADE -->
<div class="screen" id="upgradeScreen">
  <div class="logo" style="font-size:1.8rem">‚¨Ü Upgrade Stats</div>
  <div class="sp-display">
    <div class="sp-num" id="upgradeSpCount">0</div>
    <div class="sp-lbl">Stat Points Available</div>
  </div>
  <div class="upgrade-grid" id="upgradeGrid"></div>
  <button class="btn btn-gold" onclick="show('hubScreen');renderHub()">‚úÖ Done</button>
</div>

<!-- LEVEL UP -->
<div class="screen" id="levelupScreen">
  <div class="levelup-big">üéâ</div>
  <div class="levelup-title" id="lvlTitle">LEVEL UP!</div>
  <div style="text-align:center;color:#aaa" id="lvlSub">You reached Level 2</div>
  <div class="card">
    <div class="card-title">Choose a Perk</div>
    <div class="perk-grid" id="perkGrid"></div>
  </div>
</div>

<!-- BATTLE -->
<div class="screen" id="battleScreen">
  <div class="logo" style="font-size:1.8rem">‚öîÔ∏è Battle Mode</div>
  <div class="battle-arena">
    <div class="combatants">
      <div class="fighter player">
        <div class="f-avatar" id="b-pAvatar">üèÄ</div>
        <div class="f-name"   id="b-pName">You</div>
        <div class="f-hp-wrap"><div class="f-hp-bar player" id="b-pHp" style="width:100%"></div></div>
        <div class="f-hp-text" id="b-pHpText">100/100</div>
      </div>
      <div class="vs-badge">VS</div>
      <div class="fighter enemy">
        <div class="f-avatar" id="b-eAvatar">üò§</div>
        <div class="f-name"   id="b-eName">Rival</div>
        <div class="f-hp-wrap"><div class="f-hp-bar enemy" id="b-eHp" style="width:100%"></div></div>
        <div class="f-hp-text" id="b-eHpText">100/100</div>
      </div>
    </div>
    <div class="battle-log" id="battleLog"></div>
    <div id="battleTriviaZone"></div>
    <div class="battle-actions" id="battleActions" style="display:none">
      <button class="battle-action" onclick="battleAction('attack')">‚ö° Attack<br><small>Answer trivia for damage</small></button>
      <button class="battle-action" onclick="battleAction('special')">üåü Special Move<br><small>High risk, high reward</small></button>
    </div>
    <div id="battleEndZone"></div>
  </div>
</div>

</div><!-- /wrap -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA ‚Äî every question now has a sport property
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SPORT_BONUSES = {
  basketball:{ speed:3, power:0, iq:0, stamina:0, clutch:2 },
  football:  { speed:0, power:3, iq:0, stamina:2, clutch:0 },
  soccer:    { speed:2, power:0, iq:0, stamina:3, clutch:0 },
};
const CLASS_BONUSES = {
  scorer:   { speed:0, power:3, iq:0, stamina:0, clutch:3 },
  speedster:{ speed:4, power:0, iq:0, stamina:3, clutch:0 },
  playmaker:{ speed:0, power:0, iq:5, stamina:0, clutch:2 },
};
const CLASS_AVATARS = { basketball:'üèÄ', football:'üèà', soccer:'‚öΩ' };
const STAT_META = {
  speed:  { label:'Speed',   icon:'‚ö°', bar:'bar-speed',   desc:'Dodge chance & timer bonus' },
  power:  { label:'Power',   icon:'üí™', bar:'bar-power',   desc:'Damage dealt in battles' },
  iq:     { label:'IQ',      icon:'üß†', bar:'bar-iq',      desc:'Bonus XP on correct answers' },
  stamina:{ label:'Stamina', icon:'‚ù§Ô∏è', bar:'bar-stamina', desc:'HP pool in battles' },
  clutch: { label:'Clutch',  icon:'üéØ', bar:'bar-clutch',  desc:'Streak bonuses & hard rewards' },
};
const SPORT_LABELS = { basketball:'üèÄ Basketball', football:'üèà Football', soccer:'‚öΩ Soccer' };
const XP_PER_LEVEL = lvl => 100 + lvl * 50;
const TIME_LIMITS  = { easy:20, medium:15, hard:10 };
const XP_RANGES    = { easy:[10,20], medium:[20,35], hard:[35,60] };

const PERKS = [
  { id:'iron_will',   name:'Iron Will',   icon:'üõ°Ô∏è', desc:'Stamina +2, Max HP increases',    stat:'stamina', val:2 },
  { id:'quick_hands', name:'Quick Hands', icon:'‚ö°', desc:'Speed +3, timer feels slower',     stat:'speed',   val:3 },
  { id:'big_brain',   name:'Big Brain',   icon:'üß†', desc:'IQ +3, earn 10% bonus XP always', stat:'iq',      val:3 },
  { id:'clutch_gene', name:'Clutch Gene', icon:'üéØ', desc:'Clutch +3, streaks give more XP', stat:'clutch',  val:3 },
  { id:'beast_mode',  name:'Beast Mode',  icon:'üí™', desc:'Power +3, attacks hit harder',     stat:'power',   val:3 },
  { id:'unstoppable', name:'Unstoppable', icon:'üî•', desc:'All stats +1',                     stat:'all',     val:1 },
];
const ENEMIES = [
  { name:'Street Baller',  avatar:'üèÄ', hp:80,  power:6  },
  { name:'The Linebacker', avatar:'üèà', hp:100, power:8  },
  { name:'Wonder Winger',  avatar:'‚öΩ', hp:75,  power:5  },
  { name:'The Sniper',     avatar:'üéØ', hp:90,  power:7  },
  { name:'Iron Fullback',  avatar:'üí™', hp:120, power:10 },
  { name:'Speed Demon',    avatar:'‚ö°', hp:70,  power:6  },
];

// ‚îÄ‚îÄ Each question now has sport:'basketball'|'football'|'soccer' ‚îÄ‚îÄ
const QUESTIONS = [
  // BASKETBALL ‚Äì EASY
  {sport:'basketball', diff:'easy', q:"How many points is a three-pointer worth?",                     a:["3","2","4","1"],                                                                              correct:0},
  {sport:'basketball', diff:'easy', q:"How many players are on the court per team in basketball?",     a:["5","6","4","7"],                                                                              correct:0},
  {sport:'basketball', diff:'easy', q:"Which team did LeBron win his FIRST championship with?",        a:["Miami Heat","Cleveland Cavaliers","Los Angeles Lakers","Chicago Bulls"],                      correct:0},
  {sport:'basketball', diff:'easy', q:"What is the NBA shot clock limit?",                             a:["24 seconds","30 seconds","20 seconds","35 seconds"],                                         correct:0},
  {sport:'basketball', diff:'easy', q:"How tall is a regulation NBA hoop?",                            a:["10 feet","9 feet","11 feet","12 feet"],                                                      correct:0},
  // BASKETBALL ‚Äì MEDIUM
  {sport:'basketball', diff:'medium', q:"Who holds the NBA single-game scoring record?",               a:["Wilt Chamberlain","Kobe Bryant","LeBron James","Michael Jordan"],                            correct:0},
  {sport:'basketball', diff:'medium', q:"Which player is nicknamed 'The Greek Freak'?",                a:["Giannis Antetokounmpo","Nikola Jokic","Luka Doncic","Kristaps Porzingis"],                   correct:0},
  {sport:'basketball', diff:'medium', q:"How many championships did Michael Jordan win with the Bulls?",a:["6","5","4","7"],                                                                             correct:0},
  {sport:'basketball', diff:'medium', q:"Which team has won the most NBA championships?",              a:["Boston Celtics","Los Angeles Lakers","Chicago Bulls","Golden State Warriors"],                correct:0},
  {sport:'basketball', diff:'medium', q:"How many career MVP awards did Kareem Abdul-Jabbar win?",     a:["6","5","4","3"],                                                                             correct:0},
  // BASKETBALL ‚Äì HARD
  {sport:'basketball', diff:'hard', q:"How many points did Wilt Chamberlain score in his record game?",a:["100","98","102","95"],                                                                       correct:0},
  {sport:'basketball', diff:'hard', q:"What year was the NBA founded?",                                a:["1946","1950","1940","1955"],                                                                 correct:0},
  {sport:'basketball', diff:'hard', q:"Stephen Curry's record single-season three-pointer count?",     a:["402","387","368","415"],                                                                     correct:0},
  {sport:'basketball', diff:'hard', q:"Which country won the 1936 Olympic basketball gold medal?",     a:["United States","Canada","Soviet Union","Brazil"],                                            correct:0},
  {sport:'basketball', diff:'hard', q:"Who won the first NBA Slam Dunk Contest in 1976?",              a:["Julius Erving","David Thompson","Artis Gilmore","George Gervin"],                           correct:0},
  // FOOTBALL ‚Äì EASY
  {sport:'football', diff:'easy', q:"How many points does a touchdown score?",                         a:["6","7","8","5"],                                                                             correct:0},
  {sport:'football', diff:'easy', q:"How many players per team are on the field in the NFL?",          a:["11","12","10","9"],                                                                          correct:0},
  {sport:'football', diff:'easy', q:"Who won Super Bowl LVIII in 2024?",                               a:["Kansas City Chiefs","San Francisco 49ers","Baltimore Ravens","Buffalo Bills"],                correct:0},
  {sport:'football', diff:'easy', q:"How many downs does an offense get to move 10 yards?",            a:["4","3","5","6"],                                                                             correct:0},
  {sport:'football', diff:'easy', q:"What does NFL stand for?",                                        a:["National Football League","National Field League","North Football League","National Finals League"], correct:0},
  // FOOTBALL ‚Äì MEDIUM
  {sport:'football', diff:'medium', q:"Which QB has won the most Super Bowls?",                        a:["Tom Brady","Joe Montana","Terry Bradshaw","Patrick Mahomes"],                                 correct:0},
  {sport:'football', diff:'medium', q:"How long is an NFL field from end zone to end zone?",           a:["100 yards","110 yards","120 yards","90 yards"],                                              correct:0},
  {sport:'football', diff:'medium', q:"What is the name of the Super Bowl trophy?",                    a:["Vince Lombardi Trophy","George Halas Trophy","Pete Rozelle Trophy","Walter Payton Trophy"],  correct:0},
  {sport:'football', diff:'medium', q:"Which NFL team plays their home games at Lambeau Field?",       a:["Green Bay Packers","Chicago Bears","Minnesota Vikings","Detroit Lions"],                     correct:0},
  {sport:'football', diff:'medium', q:"How many points is a safety worth in football?",                a:["2","1","3","6"],                                                                             correct:0},
  // FOOTBALL ‚Äì HARD
  {sport:'football', diff:'hard', q:"Who holds the NFL record for most career passing touchdowns?",    a:["Tom Brady","Peyton Manning","Drew Brees","Brett Favre"],                                     correct:0},
  {sport:'football', diff:'hard', q:"LaDainian Tomlinson's single-season rushing TD record?",          a:["28","24","26","30"],                                                                         correct:0},
  {sport:'football', diff:'hard', q:"In what city was the very first Super Bowl played?",              a:["Los Angeles","New Orleans","Miami","Green Bay"],                                             correct:0},
  {sport:'football', diff:'hard', q:"What overall pick was Patrick Mahomes drafted in 2017?",          a:["10th","15th","7th","22nd"],                                                                  correct:0},
  {sport:'football', diff:'hard', q:"What was the final score of the highest-scoring Super Bowl ever?",a:["55-10","49-26","43-8","41-33"],                                                              correct:0},
  // SOCCER ‚Äì EASY
  {sport:'soccer', diff:'easy', q:"How many players per team are on a soccer field?",                  a:["11","10","12","9"],                                                                          correct:0},
  {sport:'soccer', diff:'easy', q:"How long is a standard soccer match?",                              a:["90 minutes","80 minutes","100 minutes","60 minutes"],                                        correct:0},
  {sport:'soccer', diff:'easy', q:"Which country has won the most FIFA World Cups?",                   a:["Brazil","Germany","Argentina","Italy"],                                                      correct:0},
  {sport:'soccer', diff:'easy', q:"What color card is shown to send a soccer player off the field?",   a:["Red","Yellow","Orange","Black"],                                                             correct:0},
  {sport:'soccer', diff:'easy', q:"Who won 8 Ballon d'Or awards ‚Äî the most all time?",                 a:["Lionel Messi","Cristiano Ronaldo","Pel√©","Zinedine Zidane"],                                 correct:0},
  // SOCCER ‚Äì MEDIUM
  {sport:'soccer', diff:'medium', q:"Which club has won the most UEFA Champions League titles?",       a:["Real Madrid","FC Barcelona","Bayern Munich","AC Milan"],                                     correct:0},
  {sport:'soccer', diff:'medium', q:"What is a 'hat trick' in soccer?",                               a:["3 goals by one player","A penalty kick","A header goal","Two goals in a row"],               correct:0},
  {sport:'soccer', diff:'medium', q:"Which country hosted the 2022 FIFA World Cup?",                   a:["Qatar","Saudi Arabia","UAE","Bahrain"],                                                      correct:0},
  {sport:'soccer', diff:'medium', q:"What does 'offside' mean in soccer?",                             a:["Illegal position near opponent's goal","A foul tackle","Using hands","Delay of game"],       correct:0},
  {sport:'soccer', diff:'medium', q:"Who won the Golden Boot at the 2022 World Cup?",                  a:["Kylian Mbapp√©","Lionel Messi","Olivier Giroud","Richarlison"],                               correct:0},
  // SOCCER ‚Äì HARD
  {sport:'soccer', diff:'hard', q:"What is Miroslav Klose's all-time World Cup goals record?",         a:["16","15","14","17"],                                                                         correct:0},
  {sport:'soccer', diff:'hard', q:"What year did the English Premier League begin?",                   a:["1992","1990","1988","1995"],                                                                 correct:0},
  {sport:'soccer', diff:'hard', q:"Which goalkeeper holds the record for most Premier League clean sheets?", a:["Petr Cech","Edwin van der Sar","David James","Mark Schwarzer"],                       correct:0},
  {sport:'soccer', diff:'hard', q:"Who scored the famous 'Hand of God' goal in the 1986 World Cup?",  a:["Diego Maradona","Pel√©","Roberto Baggio","Johan Cruyff"],                                     correct:0},
  {sport:'soccer', diff:'hard', q:"Which country won the very first FIFA World Cup in 1930?",          a:["Uruguay","Brazil","Argentina","Italy"],                                                      correct:0},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let hero = {
  name:'', sport:'basketball', heroClass:'scorer',
  level:1, xp:0, sp:0,
  stats:{ speed:5, power:5, iq:5, stamina:5, clutch:5 },
  perks:[], badges:[]
};
let triviaState = {
  diff:'easy', questions:[], current:0,
  xpEarned:0, streak:0, bestStreak:0, correct:0,
  timer:null, timeLeft:0, answered:false, dots:[]
};
let battleQ    = { q:null, answered:false, timer:null, timeLeft:0, action:'', diff:'medium' };
let battleState = { enemy:null, pHp:0, eHp:0, pMaxHp:0, eMaxHp:0 };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function show(id){
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id === 'upgradeScreen') renderUpgrade();
}
function shuffle(arr){ return [...arr].sort(() => Math.random() - .5); }
function clamp(v,mn,mx){ return Math.max(mn, Math.min(mx, v)); }
function statPct(v){ return clamp((v/30)*100, 4, 100); }

// Sport badge helper ‚Äî uses the question's own sport property
function setSportBadge(el, sport){
  el.textContent  = SPORT_LABELS[sport] || 'üéØ Sports';
  el.className    = 'sport-badge badge-' + sport;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHARACTER CREATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectSport(el){
  document.querySelectorAll('.sport-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel'); hero.sport = el.dataset.sport;
}
function selectClass(el){
  document.querySelectorAll('.class-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel'); hero.heroClass = el.dataset.class;
  showClassPreview();
}
function goToClass(){
  const name = document.getElementById('nameInput').value.trim();
  if(!name){ alert('Give your athlete a name!'); return; }
  if(!document.querySelector('.sport-card.sel')){ alert('Pick a sport!'); return; }
  hero.name = name; show('createScreen2');
}
function showClassPreview(){
  const s=SPORT_BONUSES[hero.sport], c=CLASS_BONUSES[hero.heroClass];
  let html='';
  ['speed','power','iq','stamina','clutch'].forEach(k=>{
    const total=5+(s[k]||0)+(c[k]||0), m=STAT_META[k];
    html+=`<div class="stat-row" style="margin-bottom:8px">
      <div class="stat-label">${m.icon} ${m.label}</div>
      <div class="stat-bar-wrap"><div class="stat-bar ${m.bar}" style="width:${statPct(total)}%"></div></div>
      <div class="stat-val">${total}</div></div>`;
  });
  document.getElementById('classPreviewStats').innerHTML=html;
  document.getElementById('classPrev').style.display='block';
}
function finalizeChar(){
  if(!document.querySelector('.class-card.sel')){ alert('Pick a class!'); return; }
  const s=SPORT_BONUSES[hero.sport], c=CLASS_BONUSES[hero.heroClass];
  Object.keys(hero.stats).forEach(k=>{ hero.stats[k]=5+(s[k]||0)+(c[k]||0); });
  renderHub(); show('hubScreen');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HUB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHub(){
  document.getElementById('hubAvatar').textContent = CLASS_AVATARS[hero.sport]||'üèÜ';
  document.getElementById('hubName').textContent   = hero.name;
  document.getElementById('hubLevel').textContent  = `Level ${hero.level}`;
  document.getElementById('hubClass').textContent  = hero.heroClass.charAt(0).toUpperCase()+hero.heroClass.slice(1);
  let html='';
  Object.keys(STAT_META).forEach(k=>{
    const m=STAT_META[k];
    html+=`<div class="stat-row">
      <div class="stat-label">${m.icon} ${m.label}</div>
      <div class="stat-bar-wrap"><div class="stat-bar ${m.bar}" style="width:${statPct(hero.stats[k])}%"></div></div>
      <div class="stat-val">${hero.stats[k]}</div></div>`;
  });
  document.getElementById('statsPanel').innerHTML=html;
  const need=XP_PER_LEVEL(hero.level);
  document.getElementById('xpLabel').textContent=`${hero.xp} / ${need} XP`;
  document.getElementById('xpBar').style.width=`${clamp((hero.xp/need)*100,0,100)}%`;
  document.getElementById('spCount').textContent=hero.sp;
  hero.badges.forEach(b=>{ const el=document.getElementById('badge-'+b); if(el) el.classList.add('earned'); });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// XP + LEVEL UP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gainXP(amount){
  const bonus = hero.perks.includes('big_brain') ? Math.floor(amount*.1) : 0;
  hero.xp += amount+bonus;
  let leveled=false;
  while(hero.xp >= XP_PER_LEVEL(hero.level)){ hero.xp-=XP_PER_LEVEL(hero.level); hero.level++; hero.sp+=3; leveled=true; }
  return leveled;
}
function earnBadge(id){ if(!hero.badges.includes(id)) hero.badges.push(id); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRIVIA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startTrivia(diff){
  triviaState = { diff, questions:[], current:0, xpEarned:0, streak:0, bestStreak:0, correct:0, timer:null, timeLeft:0, answered:false, dots:[] };
  triviaState.questions = shuffle(QUESTIONS.filter(q => q.diff === diff)).slice(0,5);

  const dc=document.getElementById('progressDots'); dc.innerHTML='';
  for(let i=0;i<5;i++){
    const d=document.createElement('div'); d.className='dot'; dc.appendChild(d); triviaState.dots.push(d);
  }
  document.getElementById('t-xp').textContent=0;
  document.getElementById('t-streak').textContent=0;
  show('triviaScreen');
  loadTriviaQ();
}

function loadTriviaQ(){
  triviaState.answered=false;
  const q=triviaState.questions[triviaState.current];

  document.getElementById('feedback').textContent='';
  document.getElementById('feedback').className='feedback';
  document.getElementById('rewardPopup').style.display='none';

  // ‚îÄ‚îÄ Use q.sport directly ‚Äî always accurate ‚îÄ‚îÄ
  setSportBadge(document.getElementById('sportBadge'), q.sport);
  document.getElementById('diffBadge').textContent = q.diff;
  document.getElementById('diffBadge').className   = 'diff-badge diff-' + q.diff;
  document.getElementById('qText').textContent     = q.q;
  document.getElementById('t-qnum').textContent    = `${triviaState.current+1}/5`;

  const grid=document.getElementById('answersGrid'); grid.innerHTML='';
  shuffle([0,1,2,3]).forEach(i=>{
    const btn=document.createElement('button');
    btn.className='ans-btn'; btn.textContent=q.a[i];
    btn.addEventListener('click',()=>pickTriviaAnswer(i,btn));
    grid.appendChild(btn);
  });

  clearInterval(triviaState.timer);
  triviaState.timeLeft=TIME_LIMITS[diff];
  updateTriviaTimer();
  triviaState.timer=setInterval(()=>{
    triviaState.timeLeft--;
    updateTriviaTimer();
    if(triviaState.timeLeft<=0){ clearInterval(triviaState.timer); triviaTimeUp(); }
  },1000);
}

// tiny alias so loadTriviaQ can reference triviaState.diff properly
Object.defineProperty(window,'diff',{ get(){ return triviaState.diff; } });

function updateTriviaTimer(){
  const pct=(triviaState.timeLeft/TIME_LIMITS[triviaState.diff])*100;
  const bar=document.getElementById('timerBar');
  bar.style.width=pct+'%';
  bar.style.background=pct>50?'#2ecc71':pct>25?'#f7c948':'#e63946';
}

function pickTriviaAnswer(idx,btn){
  if(triviaState.answered) return;
  triviaState.answered=true;
  clearInterval(triviaState.timer);
  const q=triviaState.questions[triviaState.current];
  document.querySelectorAll('.ans-btn').forEach(b=>{ b.disabled=true; if(b.textContent===q.a[q.correct]) b.classList.add('correct'); });

  if(idx===q.correct){
    btn.classList.add('correct');
    triviaState.correct++; triviaState.streak++;
    if(triviaState.streak>triviaState.bestStreak) triviaState.bestStreak=triviaState.streak;
    const [mn,mx]=XP_RANGES[triviaState.diff];
    let xp=Math.floor(mn+(mx-mn)*(triviaState.timeLeft/TIME_LIMITS[triviaState.diff]));
    xp=Math.floor(xp*(1+hero.stats.iq*0.02));
    if(triviaState.streak>=3) xp=Math.floor(xp*(1+hero.stats.clutch*0.015));
    triviaState.xpEarned+=xp;
    document.getElementById('t-xp').textContent=triviaState.xpEarned;
    document.getElementById('t-streak').textContent=triviaState.streak;
    document.getElementById('feedback').textContent=getRightMsg();
    document.getElementById('feedback').className='feedback correct';
    triviaState.dots[triviaState.current].classList.add('correct');
    const rp=document.getElementById('rewardPopup');
    rp.textContent=`+${xp} XP ${triviaState.streak>=3?'üî• STREAK BONUS!':''}`;
    rp.style.display='block';
    earnBadge('first');
  } else {
    btn.classList.add('wrong');
    triviaState.streak=0;
    document.getElementById('t-streak').textContent=0;
    document.getElementById('feedback').textContent=`‚ùå Answer: ${q.a[q.correct]}`;
    document.getElementById('feedback').className='feedback wrong';
    triviaState.dots[triviaState.current].classList.add('wrong');
  }
  setTimeout(()=>{ triviaState.current++; triviaState.current<5 ? loadTriviaQ() : endTrivia(); },1600);
}

function triviaTimeUp(){
  if(triviaState.answered) return;
  triviaState.answered=true; triviaState.streak=0;
  document.getElementById('t-streak').textContent=0;
  const q=triviaState.questions[triviaState.current];
  document.querySelectorAll('.ans-btn').forEach(b=>{ b.disabled=true; if(b.textContent===q.a[q.correct]) b.classList.add('correct'); });
  document.getElementById('feedback').textContent=`‚è∞ Time! Answer: ${q.a[q.correct]}`;
  document.getElementById('feedback').className='feedback wrong';
  triviaState.dots[triviaState.current].classList.add('wrong');
  setTimeout(()=>{ triviaState.current++; triviaState.current<5 ? loadTriviaQ() : endTrivia(); },1600);
}

function endTrivia(){
  if(triviaState.bestStreak>=3) earnBadge('streak3');
  if(triviaState.bestStreak>=5) earnBadge('streak5');
  if(triviaState.correct===5)   earnBadge('perfect');
  const leveled=gainXP(triviaState.xpEarned);
  let statGains=[];
  if(triviaState.correct>=4){ const k=Object.keys(hero.stats)[Math.floor(Math.random()*5)]; hero.stats[k]++; statGains.push(`${STAT_META[k].icon} ${STAT_META[k].label} +1`); }
  if(triviaState.bestStreak>=3){ hero.stats.clutch++; statGains.push('üéØ Clutch +1'); }
  if(hero.level>=5)  earnBadge('level5');
  if(hero.level>=10) earnBadge('level10');
  document.getElementById('resultXP').textContent=`+${triviaState.xpEarned} XP`;
  const emojis=['üòÖ','üòê','üòä','üî•','‚≠ê','üèÜ'];
  document.getElementById('resultEmoji').textContent=emojis[triviaState.correct]||'‚≠ê';
  document.getElementById('resultMsg').textContent=
    triviaState.correct===5?'PERFECT! All 5 correct!':`${triviaState.correct}/5 correct ‚Äî ${Math.round((triviaState.correct/5)*100)}% accuracy`;
  const sc=document.getElementById('statGainCard');
  if(statGains.length){
    document.getElementById('statGainList').innerHTML=statGains.map(s=>`<div style="color:#2ecc71;font-weight:700;font-size:.9rem;margin:4px 0">‚úÖ ${s}</div>`).join('');
    sc.style.display='block';
  } else sc.style.display='none';
  document.getElementById('playAgainBtn').onclick=()=>startTrivia(triviaState.diff);
  if(leveled) setTimeout(()=>showLevelUp(),400);
  else { renderHub(); show('resultsScreen'); }
}

function getRightMsg(){
  const m=['üéØ Nailed it!','üî• Correct!','üí™ Nice!','‚ö° Right!','üèÜ Boom!','üò§ Easy!'];
  return m[Math.floor(Math.random()*m.length)];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LEVEL UP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showLevelUp(){
  document.getElementById('lvlTitle').textContent=`LEVEL ${hero.level}!`;
  document.getElementById('lvlSub').textContent=`You reached Level ${hero.level}! Choose a perk:`;
  const available=PERKS.filter(p=>!hero.perks.includes(p.id));
  const picks=shuffle(available).slice(0,Math.min(4,available.length));
  const grid=document.getElementById('perkGrid'); grid.innerHTML='';
  picks.forEach(p=>{
    grid.innerHTML+=`<div class="perk-card" onclick="choosePerk('${p.id}')">
      <div class="perk-icon">${p.icon}</div><div class="perk-name">${p.name}</div><div class="perk-desc">${p.desc}</div></div>`;
  });
  show('levelupScreen');
}
function choosePerk(id){
  const p=PERKS.find(x=>x.id===id); if(!p) return;
  hero.perks.push(id);
  if(p.stat==='all') Object.keys(hero.stats).forEach(k=>hero.stats[k]+=p.val);
  else if(hero.stats[p.stat]!==undefined) hero.stats[p.stat]+=p.val;
  renderHub(); show('resultsScreen');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPGRADE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderUpgrade(){
  document.getElementById('upgradeSpCount').textContent=hero.sp;
  const grid=document.getElementById('upgradeGrid'); grid.innerHTML='';
  Object.keys(STAT_META).forEach(k=>{
    const m=STAT_META[k];
    grid.innerHTML+=`<div class="upgrade-row">
      <div class="up-val">${hero.stats[k]}</div>
      <div class="up-info">
        <div class="up-name">${m.icon} ${m.label}</div>
        <div class="up-desc">${m.desc}</div>
        <div class="up-bar-wrap"><div class="up-bar ${m.bar}" style="width:${statPct(hero.stats[k])}%"></div></div>
      </div>
      <button class="up-btn" onclick="spendSP('${k}')" ${hero.sp<1?'disabled':''}>+1 (1 SP)</button>
    </div>`;
  });
}
function spendSP(stat){ if(hero.sp<1) return; hero.sp--; hero.stats[stat]++; renderUpgrade(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BATTLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startBattle(){
  const enemy=shuffle(ENEMIES)[0];
  const pMaxHp=100+hero.stats.stamina*2;
  battleState={ enemy:{...enemy}, pHp:pMaxHp, eHp:enemy.hp, pMaxHp, eMaxHp:enemy.hp };
  document.getElementById('b-pAvatar').textContent=CLASS_AVATARS[hero.sport]||'üèÄ';
  document.getElementById('b-pName').textContent=hero.name;
  document.getElementById('b-eAvatar').textContent=enemy.avatar;
  document.getElementById('b-eName').textContent=enemy.name;
  updateBattleHp();
  document.getElementById('battleLog').innerHTML=`‚öîÔ∏è <b>${enemy.name}</b> challenges you!<br>`;
  document.getElementById('battleActions').style.display='grid';
  document.getElementById('battleTriviaZone').innerHTML='';
  document.getElementById('battleEndZone').innerHTML='';
  show('battleScreen');
}

function updateBattleHp(){
  const pp=clamp((battleState.pHp/battleState.pMaxHp)*100,0,100);
  const ep=clamp((battleState.eHp/battleState.eMaxHp)*100,0,100);
  document.getElementById('b-pHp').style.width=pp+'%';
  document.getElementById('b-eHp').style.width=ep+'%';
  document.getElementById('b-pHpText').textContent=`${Math.max(0,Math.round(battleState.pHp))}/${battleState.pMaxHp}`;
  document.getElementById('b-eHpText').textContent=`${Math.max(0,Math.round(battleState.eHp))}/${battleState.eMaxHp}`;
}
function bLog(msg){ const l=document.getElementById('battleLog'); l.innerHTML+=msg+'<br>'; l.scrollTop=l.scrollHeight; }

function battleAction(type){
  document.getElementById('battleActions').style.display='none';
  const diff = type==='special' ? 'hard' : 'medium';
  const pool  = QUESTIONS.filter(q => q.diff === diff);
  const q     = shuffle(pool)[0];
  battleQ = { q, answered:false, timer:null, timeLeft:TIME_LIMITS[diff], action:type, diff };

  // Build sport badge for battle using q.sport directly
  const sportLabel = SPORT_LABELS[q.sport] || 'üéØ Sports';
  const sportClass = 'btv-badge badge-' + q.sport;

  const zone=document.getElementById('battleTriviaZone');
  zone.innerHTML=`
    <div class="btv-card">
      <div class="btv-label">${type==='special'?'üåü SPECIAL MOVE ‚Äî Hard Question!':'‚ö° ATTACK ‚Äî Answer correctly to deal damage!'}</div>
      <span class="${sportClass}">${sportLabel}</span>
      <div class="btv-qtext" id="btv-qtext">${q.q}</div>
      <div class="btv-answers" id="btv-answers"></div>
      <div class="btv-feedback" id="btv-feedback"></div>
      <div class="btv-timer-wrap"><div class="btv-timer-bar" id="btv-timer-bar"></div></div>
    </div>`;

  const grid=document.getElementById('btv-answers');
  shuffle([0,1,2,3]).forEach(i=>{
    const btn=document.createElement('button');
    btn.className='btv-ans'; btn.textContent=q.a[i];
    btn.addEventListener('click',()=>pickBattleAnswer(i,btn));
    grid.appendChild(btn);
  });

  updateBattleTimer();
  battleQ.timer=setInterval(()=>{
    battleQ.timeLeft--;
    updateBattleTimer();
    if(battleQ.timeLeft<=0){ clearInterval(battleQ.timer); battleTimerUp(); }
  },1000);
}

function updateBattleTimer(){
  const pct=(battleQ.timeLeft/TIME_LIMITS[battleQ.diff])*100;
  const bar=document.getElementById('btv-timer-bar');
  if(!bar) return;
  bar.style.width=pct+'%';
  bar.style.background=pct>50?'#2ecc71':pct>25?'#f7c948':'#e63946';
}

function pickBattleAnswer(idx,btn){
  if(battleQ.answered) return;
  battleQ.answered=true;
  clearInterval(battleQ.timer);
  const q=battleQ.q;
  document.querySelectorAll('.btv-ans').forEach(b=>{ b.disabled=true; if(b.textContent===q.a[q.correct]) b.classList.add('correct'); });
  const fb=document.getElementById('btv-feedback');
  if(idx===q.correct){
    btn.classList.add('correct');
    if(fb){ fb.textContent='‚úÖ Correct!'; fb.className='btv-feedback correct'; }
    setTimeout(()=>resolveBattle(true),1400);
  } else {
    btn.classList.add('wrong');
    if(fb){ fb.textContent=`‚ùå Answer: ${q.a[q.correct]}`; fb.className='btv-feedback wrong'; }
    setTimeout(()=>resolveBattle(false),1400);
  }
}

function battleTimerUp(){
  if(battleQ.answered) return;
  battleQ.answered=true;
  const q=battleQ.q;
  document.querySelectorAll('.btv-ans').forEach(b=>{ b.disabled=true; if(b.textContent===q.a[q.correct]) b.classList.add('correct'); });
  const fb=document.getElementById('btv-feedback');
  if(fb){ fb.textContent=`‚è∞ Time! Answer: ${q.a[q.correct]}`; fb.className='btv-feedback wrong'; }
  setTimeout(()=>resolveBattle(false),1400);
}

function resolveBattle(correct){
  document.getElementById('battleTriviaZone').innerHTML='';
  if(correct){
    let dmg=Math.floor((5+hero.stats.power)*(battleQ.action==='special'?2:1));
    dmg=Math.floor(dmg*(1+hero.stats.clutch*.02));
    battleState.eHp-=dmg;
    bLog(`‚ö° <b>${hero.name}</b> deals <b style="color:#f7c948">${dmg} damage</b>!`);
  } else {
    bLog(`üò¨ Missed the question ‚Äî no damage!`);
  }
  setTimeout(()=>{
    if(battleState.eHp>0){
      if(Math.random()<hero.stats.speed*0.02){
        bLog(`üí® You dodged the attack! (Speed ${hero.stats.speed})`);
      } else {
        const eDmg=battleState.enemy.power;
        battleState.pHp-=eDmg;
        bLog(`üí• <b>${battleState.enemy.name}</b> hits for <b style="color:#e63946">${eDmg} damage</b>!`);
      }
    }
    updateBattleHp();
    if(battleState.pHp<=0||battleState.eHp<=0) endBattle();
    else document.getElementById('battleActions').style.display='grid';
  },600);
}

function endBattle(){
  const won=battleState.eHp<=0;
  gainXP(won?80:20);
  if(won) earnBadge('battle');
  bLog(won
    ? `üèÜ <b>VICTORY!</b> You defeated ${battleState.enemy.name}! +80 XP`
    : `üíÄ <b>DEFEAT.</b> ${battleState.enemy.name} wins. +20 XP for trying!`);
  document.getElementById('battleEndZone').innerHTML=`
    <div style="margin-top:14px;display:flex;gap:12px;justify-content:center">
      <button class="btn btn-gold"    onclick="startBattle()">‚öîÔ∏è Battle Again</button>
      <button class="btn btn-outline" onclick="show('hubScreen');renderHub()">üè† Hub</button>
    </div>`;
  renderHub();
}

// INIT
show('introScreen');
</script>
</body>
</html>
